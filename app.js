"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _express=require("express"),_express2=_interopRequireDefault(_express),_path=require("path"),_path2=_interopRequireDefault(_path),_serveFavicon=require("serve-favicon"),_serveFavicon2=_interopRequireDefault(_serveFavicon),_morgan=require("morgan"),_morgan2=_interopRequireDefault(_morgan),_bodyParser=require("body-parser"),_bodyParser2=_interopRequireDefault(_bodyParser),_cookieParser=require("cookie-parser"),_cookieParser2=_interopRequireDefault(_cookieParser),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_remarkable=require("remarkable"),_remarkable2=_interopRequireDefault(_remarkable),_smurfs=require("./routes/smurfs"),_index=require("./routes/index"),_index2=_interopRequireDefault(_index),app=(0,_express2.default)();app.set("views",_path2.default.join(__dirname,"views")),app.set("view engine","hbs"),console.log(process.env.STEAM_API_KEY),app.use((0,_morgan2.default)("dev")),app.use(_bodyParser2.default.json()),app.use(_bodyParser2.default.urlencoded({extended:!1})),app.use((0,_cookieParser2.default)()),app.use(_express2.default.static(_path2.default.join(__dirname,"public"))),app.use("/",_index2.default),app.post("/",function(e,r){if(!e.body)return r.sendStatus(400);var a=__dirname+"/status.md",s=e.body.input;_fs2.default.writeFile(a,s,function(e){if(e)throw e;var a=new _remarkable2.default;(0,_smurfs.scrape)().then(function(e){var s=a.render(e);s.indexOf("<table>")?r.render("index",{output:s}):r.render("index",{output:'<table class="table table-hover">'+s.slice(7)})})})}),app.use(function(e,r,a){var s=new Error("Not Found");s.status=404,a(s)}),"development"===app.get("env")&&app.use(function(e,r,a,s){a.status(e.status||500),a.render("error",{message:e.message,error:e})}),app.use(function(e,r,a,s){a.status(e.status||500),a.render("error",{message:e.message,error:{}})}),module.exports=app;